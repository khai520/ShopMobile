@page "/"
@layout Layout.MainLayout

@inject IJSRuntime JS
@inject IProductService monAnService
@inject IChiTietProductService chiTietMonAnService
<PageTitle>Jolly - Đồ Ăn Vặt Ngon</PageTitle>
<link href="css/Home.css" rel="stylesheet" />


<section class="hero" id="home">
    <div class="container">
        <h1>🎉 Chào mừng đến với Jolly! 🎉</h1>
        <p>Đồ ăn vặt ngon nhất, tươi ngon mỗi ngày</p>
        <button class="cta-btn" @onclick="ScrollToProducts">Khám phá ngay! ✨</button>
    </div>
</section>

<section class="products" id="products">
    <div class="container">
        <h2 class="section-title">🍭 Sản phẩm nổi bật 🍭</h2>
        <div class="product-grid">
            @foreach (var item in MonAns)
            {
                <JollyWeb.Components.Pages.SanPham.SanPham monAn="item"/>
            }
        </div>
    </div>
</section>

<section class="features">
    <div class="container">
        <h2 class="section-title">✨ Tại sao chọn Jolly? ✨</h2>
        <div class="features-grid">
            <div class="feature-card">
                <div class="feature-icon">🚀</div>
                <h3>Giao hàng nhanh</h3>
                <p>Giao hàng trong 30 phút tại nội thành, đảm bảo độ tươi ngon</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">🌟</div>
                <h3>Chất lượng cao</h3>
                <p>Nguyên liệu tươi ngon, quy trình sản xuất hiện đại và an toàn</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">💝</div>
                <h3>Giá cả hợp lý</h3>
                <p>Giá cả phải chăng với chất lượng tuyệt vời, nhiều ưu đãi hấp dẫn</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">🎯</div>
                <h3>Phục vụ 24/7</h3>
                <p>Luôn sẵn sàng phục vụ bạn mọi lúc, mọi nơi với tinh thần nhiệt tình</p>
            </div>
        </div>
    </div>
</section>



@code {
    [Inject] NavigationManager Navigation { get; set; }
    public List<ProductDTO> MonAns = new();
    private bool _hasInitialized = false;
    protected override async Task OnAfterRenderAsync(bool firstRender)
    {

        if (firstRender && !_hasInitialized)
        {
            await JS.InvokeVoidAsync("localStorage.removeItem", "checkoutItems");
            await JS.InvokeVoidAsync("localStorage.removeItem", "pendingOrder");
            _hasInitialized = true;
            StateHasChanged();
        }
    }
    protected override async Task OnInitializedAsync()
    {
        
        var monAns = await monAnService.GetAll() ?? new();
        var ctma = await chiTietMonAnService.GetAll() ?? new();


        MonAns = monAns
            .Where(mon => mon.TrangThai == true &&
                        ctma.Any(c => c.ProductId == mon.Id
                                    && c.TrangThai == true
                                    && c.Soluong > 0)).Take(5)
            .ToList();
    }



    private void ToggleCart()
    {
        
    }

    private async Task ScrollToProducts()
    {
        Console.WriteLine("Test");
        await JS.InvokeVoidAsync("document.getElementById", "products");
    }

}
